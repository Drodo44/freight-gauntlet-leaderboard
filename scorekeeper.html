<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Freight Gauntlet â€” Scorekeeper (Week 2)</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,Helvetica,sans-serif;background:#0e1a28;color:#eaf1ff;margin:0}
  header{background:#132a4e;padding:12px 16px;font-weight:700}
  .wrap{display:grid;grid-template-columns:380px 1fr;gap:16px;padding:16px}
  .card{background:#1b2a3c;border:1px solid #274060;border-radius:10px;padding:12px}
  label{display:block;font-size:12px;color:#a9bed9;margin-top:8px}
  input[type="number"],select{width:100%;padding:8px;border-radius:6px;border:1px solid #274060;background:#0e1a28;color:#fff}
  .row{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
  button{border:0;color:#0b1a2c;font-weight:700;padding:10px 12px;border-radius:8px;cursor:pointer;margin-top:10px}
  .primary{background:#48bb78}.accent{background:#4299e1;color:#061624}.warn{background:#f6ad55;color:#1b2a3c}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid #274060;padding:6px 8px;font-size:12px;vertical-align:top}
  .muted{color:#a9bed9;font-size:12px;margin-top:6px}
  .ok{color:#b7f7c2}.warn-t{color:#ffd37a}.err{color:#ff9da3}
  .preview{max-height:70vh;overflow:auto}
</style>
</head>
<body>
<header>Freight Gauntlet â€” Scorekeeper (Week 2)</header>

<div class="wrap">
  <!-- Left: Form -->
  <div class="card">
    <div style="font-weight:700;margin-bottom:8px">Add / Replace Week 2 Totals</div>

    <label>Member</label>
    <select id="member"><option value="" disabled selected>â€” select â€”</option></select>

    <div class="row">
      <div><label>Calls</label><input id="calls" type="number" min="0" step="1" placeholder="e.g. 707"></div>
      <div><label>Covers</label><input id="covers" type="number" min="0" step="1"></div>
    </div>

    <div class="row">
      <div><label>Group Covers</label><input id="gcovers" type="number" min="0" step="1"></div>
      <div><label>Closes &lt;$382 (LAET)</label><input id="cl_lt" type="number" min="0" step="1"></div>
    </div>

    <div class="row">
      <div><label>Closes â‰¥$382 (or any closes for non-LAET)</label><input id="cl_ge" type="number" min="0" step="1"></div>
      <div><label>Revenue Above Plan ($)</label><input id="rap" type="number" min="0" step="1" placeholder="PG=$250 blocks â€¢ Junior=$500"></div>
    </div>

    <div class="row">
      <div><label>BR &gt; T12 ($) (LAE&gt;5k)</label><input id="t12" type="number" min="0" step="1"></div>
      <div><label>YOY Growth ($) (Vet)</label><input id="yoy" type="number" min="0" step="1"></div>
    </div>

    <div class="row">
      <div><label>Assists</label><input id="assists" type="number" min="0" step="1"></div>
      <div>
        <label>BR/Load &gt; $382?</label>
        <select id="brload"><option value="">No</option><option value="yes">Yes</option></select>
      </div>
    </div>

    <button id="applyReplace" class="primary">Apply â€” Replace Week 2</button>
    <button id="applyAdd" class="accent">Apply â€” Add (incremental)</button>
    <button id="reset" class="warn">Reset Week 2 for member</button>
    <div class="muted">Replace = use week-to-date totals. Add = treat inputs as new achievements only.</div>

    <button id="download" class="primary" style="width:100%;margin-top:12px">Download Updated index.html</button>
    <div id="status" class="muted" style="margin-top:8px;"></div>
  </div>

  <!-- Right: Preview -->
  <div class="card">
    <div style="font-weight:700;margin-bottom:8px">Preview (current totals)</div>
    <div id="preview" class="preview"></div>
  </div>
</div>

<script>
/* ====== CONSTANTS ====== */
const ELIMINATED = new Set(["Clarens Legagneur","Nicholas Peffenberger","Jacob Archer","Justin Bagent","Courtney Monroy"]);

const roles = new Map([
  // LAET
  ["Miguel Cordoba","LAET"],["Jennifer Fike","LAET"],["Ryan Monahan","LAET"],["Joseph Wolf","LAET"],
  ["Seth Klink","LAET"],["Bobby Meyer","LAET"],["Joseph Kisselle","LAET"],["Rachel Hack","LAET"],
  ["Henry Baker","LAET"],["Krish Daraji","LAET"],["Jared Kohn","LAET"],["Hau Cing","LAET"],
  ["Aaron Wofford","LAET"],["Emily Smith","LAET"],["Sydney Tiberghien","LAET"],["Ken Ervas","LAET"],
  ["Justin Bagent","LAET"],["Maddie Evanchik","LAET"],["Jared Miller","LAET"],["Matthew Snawder","LAET"],
  ["Quinn Fashingbauer","LAET"],["James McMullen","LAET"],
  // LAE >5k
  ["Andrew Connellan","LAE5K"],["Anthony Gordon","LAE5K"],["John Mcnulty","LAE5K"],["Daniel Covol","LAE5K"],["Sarah Miracle","LAE5K"],
  ["Anthony Fambry","LAE5K"],
  // PG/Junior
  ["Matias Janice","JUNIOR"],["Jordan DeWitt (PG)","PG"],["Kyle Taylor","JUNIOR"],["Vincent Waters","JUNIOR"],
  // Vets
  ["Jack Heyob","VET"],["Brian Amshoff","VET"],["Brian Braverman","VET"],["Brandon Fuller","VET"],
  ["Nicholas Nguyen","VET"],["Robert Hudson","VET"],["Andrew Hayes","VET"],["Dustin Schneider","VET"],["Nicholas Peffenberger","VET"]
]);

/* ====== TEAMS SNAPSHOT (current) ====== */
let teams = [
  { "name": "Team 1", "members": [
    { "name": "Nicholas Nguyen", "score": 375, "details": [
      { "label": "$10,277 YOY Growth (13Ã—$750)", "points": 325 },
      { "label": "BR/Load > $382 (Week Avg)", "points": 50 }
    ]},
    { "name": "Clarens Legagneur", "score": 0, "details": [ { "label": "Eliminated (Week 1)", "points": 0 } ]},
    { "name": "Aaron Wofford", "score": 290, "details": [
      { "label": "302 Calls > 250", "points": 25 },
      { "label": "16 Covers", "points": 80 },
      { "label": "Week 2 â€” 37 Covers", "points": 185 }
    ]},
    { "name": "Bobby Meyer", "score": 265, "details": [
      { "label": "353 Calls > 250", "points": 50 },
      { "label": "25 Covers", "points": 125 },
      { "label": "2 Group Covers", "points": 10 },
      { "label": "Week 2 â€” 16 Covers", "points": 80 }
    ]}
  ]},
  { "name": "Team 2", "members": [
    { "name": "Jordan DeWitt (PG)", "score": 0, "details": [] },
    { "name": "Hau Cing", "score": 190, "details": [
      { "label": "337 Calls > 250", "points": 25 },
      { "label": "21 Covers", "points": 105 },
      { "label": "Week 2 â€” 12 Covers", "points": 60 }
    ]},
    { "name": "Emily Smith", "score": 70, "details": [
      { "label": "262 Calls > 250", "points": 0 },
      { "label": "11 Covers", "points": 55 },
      { "label": "Week 2 â€” 3 Covers", "points": 15 }
    ]},
    { "name": "Nicholas Peffenberger", "score": 0, "details": [ { "label": "Eliminated (Week 1)", "points": 0 } ]}
  ]},
  { "name": "Team 3", "members": [
    { "name": "Jack Sullivan", "score": 100, "details": [ { "label": "Revenue Above Plan +$1,200 (4Ã—$250)", "points": 100 } ]},
    { "name": "Henry Baker", "score": 285, "details": [
      { "label": "619 Calls > 250", "points": 175 },
      { "label": "11 Covers", "points": 55 },
      { "label": "2 Group Covers", "points": 10 },
      { "label": "Week 2 â€” 9 Covers", "points": 45 }
    ]},
    { "name": "Jared Kohn", "score": 255, "details": [
      { "label": "653 Calls > 250", "points": 200 },
      { "label": "6 Covers", "points": 30 },
      { "label": "Week 2 â€” 290 Calls (Qualifier)", "points": 0 },
      { "label": "Week 2 â€” 1 Close @ $350", "points": 25 }
    ]},
    { "name": "Robert Hudson", "score": 50, "details": [ { "label": "BR/Load > $382 (Week Avg)", "points": 50 } ]}
  ]},
  { "name": "Team 4", "members": [
    { "name": "Jacob Archer", "score": 0, "details": [ { "label": "Eliminated (Week 1)", "points": 0 } ]},
    { "name": "Jack Heyob", "score": 450, "details": [ { "label": "$13,940 YOY Growth (18Ã—$750)", "points": 450 } ]},
    { "name": "Jared Miller", "score": 60, "details": [
      { "label": "287 Calls > 250", "points": 0 },
      { "label": "8 Covers", "points": 40 },
      { "label": "Week 2 â€” 4 Covers", "points": 20 }
    ]},
    { "name": "Jennifer Fike", "score": 105, "details": [
      { "label": "Did not hit call qualifier week 1", "points": 0 },
      { "label": "Week 2 â€” 18 Covers", "points": 90 },
      { "label": "Week 2 â€” 3 Group Covers", "points": 15 }
    ]}
  ]},
  { "name": "Team 5", "members": [
    { "name": "James Holcomb", "score": 340, "details": [
      { "label": "50 Calls (3Ã—15)", "points": 75 },
      { "label": "2 Assists", "points": 10 },
      { "label": "Week 2 â€” 33 Calls (2Ã—15)", "points": 50 },
      { "label": "Week 2 â€” 41 Assists", "points": 205 }
    ]},
    { "name": "Matias Janice", "score": 190, "details": [
      { "label": "Revenue Above Plan +$1,500 (3Ã—$500)", "points": 75 },
      { "label": "1 Close", "points": 20 },
      { "label": "Week 2 â€” Revenue Above Plan +$1,500 (3Ã—$500)", "points": 75 },
      { "label": "Week 2 â€” 1 Close", "points": 20 }
    ]},
    { "name": "Joseph Kisselle", "score": 145, "details": [
      { "label": "347 Calls > 250", "points": 25 },
      { "label": "1 Cover", "points": 5 },
      { "label": "1 Group Cover", "points": 5 },
      { "label": "Week 2 â€” 12 Covers", "points": 60 },
      { "label": "Week 2 â€” 10 Group Covers", "points": 50 }
    ]},
    { "name": "Joseph Wolf", "score": 160, "details": [
      { "label": "596 Calls > 250", "points": 150 },
      { "label": "Week 2 â€” 277 Calls (Qualifier)", "points": 0 },
      { "label": "Week 2 â€” 2 Covers", "points": 10 }
    ]}
  ]},
  { "name": "Team 6", "members": [
    { "name": "Vincent Waters", "score": 40, "details": [ { "label": "2 Closes", "points": 40 } ]},
    { "name": "James McMullen", "score": 0, "details": [] },
    { "name": "Maddie Evanchik", "score": 30, "details": [
      { "label": "Did not hit call qualifier week 1", "points": 0 },
      { "label": "Week 2 â€” 6 Covers", "points": 30 }
    ]},
    { "name": "Matthew Snawder", "score": 25, "details": [
      { "label": "Did not hit call qualifier week 1", "points": 0 },
      { "label": "Week 2 â€” 5 Covers", "points": 25 }
    ]},
    { "name": "Krish Daraji", "score": 255, "details": [
      { "label": "305 Calls > 250", "points": 25 },
      { "label": "26 Covers", "points": 130 },
      { "label": "1 Group Cover", "points": 5 },
      { "label": "Week 2 â€” 19 Covers", "points": 95 }
    ]}
  ]},
  { "name": "Team 7", "members": [
    { "name": "Andrew Connellan", "score": 400, "details": [
      { "label": "BR > T12 +$2,560 (10Ã—$250)", "points": 250 },
      { "label": "10 Assists", "points": 50 },
      { "label": "Week 2 â€” 20 Assists", "points": 100 }
    ]},
    { "name": "Sydney Tiberghien", "score": 95, "details": [
      { "label": "262 Calls > 250", "points": 0 },
      { "label": "8 Covers", "points": 40 },
      { "label": "Week 2 â€” 10 Covers", "points": 50 },
      { "label": "Week 2 â€” 1 Group Cover", "points": 5 }
    ]},
    { "name": "Kyle Taylor", "score": 25, "details": [ { "label": "Revenue Above Plan +$525 (1Ã—$500)", "points": 25 } ]},
    { "name": "Eric Isaacs", "score": 0, "details": [] }
  ]},
  { "name": "Team 8", "members": [
    { "name": "Miguel Cordoba", "score": 255, "details": [
      { "label": "424 Calls > 250", "points": 75 },
      { "label": "25 Covers", "points": 125 },
      { "label": "2 Group Covers", "points": 10 },
      { "label": "Week 2 â€” 251 Calls (Qualifier)", "points": 0 },
      { "label": "Week 2 â€” 9 Covers", "points": 45 }
    ]},
    { "name": "Anthony Gordon", "score": 1125, "details": [
      { "label": "BR > T12 +$10,942 (43Ã—$250)", "points": 1075 },
      { "label": "BR/Load > $382 (Week Avg)", "points": 50 }
    ]},
    { "name": "Brian Braverman", "score": 0, "details": [ { "label": "No YOY Growth (Week 1)", "points": 0 } ]},
    { "name": "Quinn Fashingbauer", "score": 0, "details": [] }
  ]},
  { "name": "Team 9", "members": [
    { "name": "Rachel Hack", "score": 475, "details": [
      { "label": "720 Calls > 250", "points": 225 },
      { "label": "17 Covers", "points": 85 },
      { "label": "3 Group Covers", "points": 15 },
      { "label": "Week 2 â€” 450 Calls > 250 (4Ã—50)", "points": 100 },
      { "label": "Week 2 â€” 9 Covers", "points": 45 },
      { "label": "Week 2 â€” 1 Group Cover", "points": 5 }
    ]},
    { "name": "Anthony Fambry", "score": 765, "details": [
      { "label": "$3,330 YOY Growth (4Ã—$750)", "points": 100 },
      { "label": "Week 2 â€” BR > T12 +$6,305 (25Ã—$250)", "points": 625 },
      { "label": "Week 2 â€” 2 Closes", "points": 40 }
    ]},
    { "name": "Seth Klink", "score": 155, "details": [
      { "label": "Did not hit call qualifier week 1", "points": 0 },
      { "label": "Week 2 â€” 1 Close @ $1225", "points": 50 },
      { "label": "Week 2 â€” 21 Covers", "points": 105 }
    ]},
    { "name": "Andrew Hayes", "score": 0, "details": [ { "label": "No YOY Growth (Week 1)", "points": 0 } ]}
  ]},
  { "name": "Team 10", "members": [
    { "name": "Brandon Fuller", "score": 25, "details": [ { "label": "$1,023 YOY Growth (1Ã—$750)", "points": 25 } ]},
    { "name": "Dustin Schneider", "score": 0, "details": [ { "label": "No YOY Growth (Week 1)", "points": 0 } ]},
    { "name": "Justin Bagent", "score": 75, "details": [
      { "label": "322 Calls > 250", "points": 25 },
      { "label": "10 Covers", "points": 50 },
      { "label": "Eliminated (Week 1)", "points": 0 }
    ]},
    { "name": "John Mcnulty", "score": 0, "details": [] },
    { "name": "Ken Ervas", "score": 50, "details": [
      { "label": "385 Calls > 250", "points": 50 },
      { "label": "Week 2 â€” 211 Calls (No qualifier)", "points": 0 }
    ]}
  ]},
  { "name": "Team 11", "members": [
    { "name": "Ryan Monahan", "score": 415, "details": [
      { "label": "574 Calls > 250", "points": 150 },
      { "label": "4 Covers", "points": 20 },
      { "label": "Week 2 â€” 707 Calls > 250 (9Ã—50)", "points": 225 },
      { "label": "Week 2 â€” 4 Covers", "points": 20 }
    ]},
    { "name": "Brian Amshoff", "score": 400, "details": [
      { "label": "$11,124 YOY Growth (14Ã—$750)", "points": 350 },
      { "label": "31 Calls (2Ã—15)", "points": 50 }
    ]},
    { "name": "Courtney Monroy", "score": 0, "details": [ { "label": "Eliminated (Week 1)", "points": 0 } ]},
    { "name": "Daniel Covol", "score": 0, "details": [] },
    { "name": "Sarah Miracle", "score": 20, "details": [ { "label": "76 Calls (1Ã—25 above 50)", "points": 20 } ]}
  ]}
];

/* ====== UI ====== */
const memberSel = document.getElementById('member');
const preview = document.getElementById('preview');
const statusEl = document.getElementById('status');

window.addEventListener('DOMContentLoaded', () => {
  const names = [];
  teams.forEach(t => t.members.forEach(m => names.push(m.name)));
  names.sort((a,b)=>a.localeCompare(b));
  names.forEach(n=>{
    const o=document.createElement('option'); o.textContent=n; o.value=n; memberSel.appendChild(o);
  });
  renderPreview();
});

/* ====== SCORING ====== */
const num = v => Math.max(0, Number(v||0));
function scoreFromEntry(entry, role){
  const lines=[]; let pts=0;
  if(role==="LAET"){
    const calls=num(entry.calls);
    if(calls>=250){
      const blocks=Math.floor((calls-250)/50);
      if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” ${calls} Calls > 250 (${blocks}Ã—50)`, points:blocks*25}); }
      else { lines.push({label:`Week 2 â€” ${calls} Calls (Qualifier)`, points:0}); }
    } else if(calls>0){ lines.push({label:`Week 2 â€” ${calls} Calls (No qualifier)`, points:0}); }
    const covers=num(entry.covers); if(covers){ pts+=covers*5; lines.push({label:`Week 2 â€” ${covers} Covers`, points:covers*5}); }
    const gc=num(entry.gcovers); if(gc){ pts+=gc*5; lines.push({label:`Week 2 â€” ${gc} Group Covers`, points:gc*5}); }
    const clLt=num(entry.cl_lt); if(clLt){ pts+=clLt*25; lines.push({label:`Week 2 â€” ${clLt} Close(s) < $382`, points:clLt*25}); }
    const clGe=num(entry.cl_ge); if(clGe){ pts+=clGe*50; lines.push({label:`Week 2 â€” ${clGe} Close(s) â‰¥ $382`, points:clGe*50}); }
    if(entry.brload==="yes"){ pts+=50; lines.push({label:`Week 2 â€” BR/Load > $382 (Week Avg)`, points:50}); }
  } else if(role==="PG"){
    const calls=num(entry.calls);
    if(calls>=350){
      const blocks=Math.floor((calls-350)/25);
      if(blocks>0){ pts+=blocks*15; lines.push({label:`Week 2 â€” ${calls} Calls > 350 (${blocks}Ã—25)`, points:blocks*15}); }
      else { lines.push({label:`Week 2 â€” ${calls} Calls (Qualifier)`, points:0}); }
    } else if(calls>0){ lines.push({label:`Week 2 â€” ${calls} Calls (No qualifier)`, points:0}); }
    const closes=num(entry.cl_ge)+num(entry.cl_lt);
    if(closes){ pts+=closes*20; lines.push({label:`Week 2 â€” ${closes} Close(s)`, points:closes*20}); }
    const rap=num(entry.rap); if(rap){ const blocks=Math.floor(rap/250); if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” Revenue Above Plan +$${rap} (${blocks}Ã—$250)`, points:blocks*25}); } }
    if(entry.brload==="yes"){ pts+=50; lines.push({label:`Week 2 â€” BR/Load > $382 (Week Avg)`, points:50}); }
  } else if(role==="JUNIOR"){
    const calls=num(entry.calls);
    if(calls>=250){
      const blocks=Math.floor((calls-250)/25);
      if(blocks>0){ pts+=blocks*15; lines.push({label:`Week 2 â€” ${calls} Calls > 250 (${blocks}Ã—25)`, points:blocks*15}); }
      else { lines.push({label:`Week 2 â€” ${calls} Calls (Qualifier)`, points:0}); }
    } else if(calls>0){ lines.push({label:`Week 2 â€” ${calls} Calls (No qualifier)`, points:0}); }
    const closes=num(entry.cl_ge)+num(entry.cl_lt);
    if(closes){ pts+=closes*20; lines.push({label:`Week 2 â€” ${closes} Close(s)`, points:closes*20}); }
    const rap=num(entry.rap); if(rap){ const blocks=Math.floor(rap/500); if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” Revenue Above Plan +$${rap} (${blocks}Ã—$500)`, points:blocks*25}); } }
    if(entry.brload==="yes"){ pts+=50; lines.push({label:`Week 2 â€” BR/Load > $382 (Week Avg)`, points:50}); }
  } else if(role==="LAE5K"){
    const calls=num(entry.calls);
    if(calls>=50){
      const blocks=Math.floor((calls-50)/25);
      if(blocks>0){ pts+=blocks*20; lines.push({label:`Week 2 â€” ${calls} Calls > 50 (${blocks}Ã—25)`, points:blocks*20}); }
      else { lines.push({label:`Week 2 â€” ${calls} Calls (Qualifier)`, points:0}); }
    } else if(calls>0){ lines.push({label:`Week 2 â€” ${calls} Calls (No qualifier)`, points:0}); }
    const t12=num(entry.t12); if(t12){ const blocks=Math.floor(t12/250); if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” BR > T12 +$${t12} (${blocks}Ã—$250)`, points:blocks*25}); } }
    const closes=num(entry.cl_ge)+num(entry.cl_lt);
    if(closes){ pts+=closes*20; lines.push({label:`Week 2 â€” ${closes} Close(s)`, points:closes*20}); }
    const assists=num(entry.assists); if(assists){ pts+=assists*5; lines.push({label:`Week 2 â€” ${assists} Assist(s)`, points:assists*5}); }
    if(entry.brload==="yes"){ pts+=50; lines.push({label:`Week 2 â€” BR/Load > $382 (Week Avg)`, points:50}); }
  } else if(role==="VET"){
    const yoy=num(entry.yoy); if(yoy){ const blocks=Math.floor(yoy/750); if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” YOY Growth +$${yoy} (${blocks}Ã—$750)`, points:blocks*25}); } }
    const calls=num(entry.calls); if(calls){ const blocks=Math.floor(calls/15); if(blocks>0){ pts+=blocks*25; lines.push({label:`Week 2 â€” ${calls} Calls (${blocks}Ã—15)`, points:blocks*25}); } }
    const assists=num(entry.assists); if(assists){ pts+=assists*5; lines.push({label:`Week 2 â€” ${assists} Assist(s)`, points:assists*5}); }
    if(entry.brload==="yes"){ pts+=50; lines.push({label:`Week 2 â€” BR/Load > $382 (Week Avg)`, points:50}); }
  }
  return {pts, lines};
}

/* ====== APPLY / RESET ====== */
document.getElementById('applyReplace').onclick = () => applyUpdate({mode:'replace'});
document.getElementById('applyAdd').onclick      = () => applyUpdate({mode:'add'});
document.getElementById('reset').onclick         = () => resetMember();

function applyUpdate({mode}){
  const name = memberSel.value;
  if(!name){ return status('Pick a member first.', 'err'); }
  if(ELIMINATED.has(name)){ return status('Cannot score eliminated player.', 'err'); }

  const role = roles.get(name) || "LAET";
  const payload = {
    calls:     document.getElementById('calls').value,
    covers:    document.getElementById('covers').value,
    gcovers:   document.getElementById('gcovers').value,
    cl_lt:     document.getElementById('cl_lt').value,
    cl_ge:     document.getElementById('cl_ge').value,
    rap:       document.getElementById('rap').value,
    t12:       document.getElementById('t12').value,
    yoy:       document.getElementById('yoy').value,
    assists:   document.getElementById('assists').value,
    brload:    document.getElementById('brload').value
  };

  const {pts, lines} = scoreFromEntry(payload, role);
  const {teamIdx, memberIdx} = findMember(name);
  if(teamIdx<0){ return status(`Member not found: ${name}`, 'err'); }
  const m = teams[teamIdx].members[memberIdx];

  let removed = 0;
  if(mode==='replace'){
    removed = removeWeek2(m);
    m.score -= removed;
  }
  lines.forEach(l => m.details.push({label:l.label, points:l.points}));
  m.score += pts;

  const net = pts - removed;
  const verb = mode==='replace'
    ? `replaced Week 2 â€” Added ${pts}, Removed ${removed}, Net ${net >=0?'+':''}${net}`
    : `added Week 2 â€” Added ${pts}, Net +${pts}`;
  status(`${name} (${role}) â€” ${verb}`, net>=0?'ok':'warn-t');
  renderPreview();
}

function resetMember(){
  const name = memberSel.value;
  if(!name){ return status('Pick a member first.', 'err'); }
  const {teamIdx, memberIdx} = findMember(name);
  if(teamIdx<0){ return status(`Member not found: ${name}`, 'err'); }
  const m = teams[teamIdx].members[memberIdx];
  const removed = removeWeek2(m);
  m.score -= removed;
  status(`${name} â€” Week 2 cleared (removed ${removed} pts)`, 'warn-t');
  renderPreview();
}

/* ====== DOWNLOAD index.html ====== */
document.getElementById('download').onclick = () => {
  const tpl = document.getElementById('index-template').innerHTML;
  const html = tpl.replace('__TEAMS_JSON__', JSON.stringify(teams, null, 2));
  const blob = new Blob([html], {type:'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'index.html';
  a.click();
  URL.revokeObjectURL(a.href);
  status('Downloaded updated index.html', 'ok');
};

/* ====== Helpers ====== */
function status(msg, cls){ statusEl.textContent = msg; statusEl.className = 'muted ' + (cls||''); }
function findMember(name){
  for(let t=0;t<teams.length;t++){
    const i = teams[t].members.findIndex(m => m.name === name);
    if(i>=0) return {teamIdx:t, memberIdx:i};
  }
  return {teamIdx:-1, memberIdx:-1};
}
function removeWeek2(member){
  if(!member.details) member.details=[];
  let removed = 0;
  member.details = member.details.filter(d => {
    const keep = !String(d.label).startsWith('Week 2 â€”');
    if(!keep) removed += Number(d.points||0);
    return keep;
  });
  return removed;
}
function renderPreview(){
  const tcopy = JSON.parse(JSON.stringify(teams));
  tcopy.forEach(t => t.total = t.members.reduce((s,m)=>s+(m.score||0),0));
  const sortedTeams = [...tcopy].sort((a,b)=>b.total-a.total);
  let html = '<table><thead><tr><th>Rank</th><th>Team</th><th>Total</th></tr></thead><tbody>';
  sortedTeams.forEach((t,i)=>{ html += `<tr><td>#${i+1}</td><td>${t.name}</td><td>${t.total} pts</td></tr>`; });
  html += '</tbody></table>';
  const all = [];
  tcopy.forEach(t=>t.members.forEach(m=>all.push({name:m.name,score:m.score,team:t.name})));
  all.sort((a,b)=>b.score-a.score);
  html += '<table><thead><tr><th colspan="3">Top 5 Individuals</th></tr></thead><tbody>';
  all.slice(0,5).forEach((p,i)=>{ html += `<tr><td>#${i+1}</td><td>${p.name}</td><td>${p.score} pts</td></tr>`; });
  html += '</tbody></table>';
  preview.innerHTML = html;
}
</script>

<!-- ========= INDEX.HTML TEMPLATE (inert) ========= -->
<template id="index-template"><!--
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Freight Gauntlet Leaderboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; padding: 0; background-color: #0e1a28; color: #f5f5f5; font-family: "Poppins", sans-serif; }
    h1 { margin: 0; padding: 20px 0; text-align: center; font-size: 2em; font-weight: 700; background-color: #132a4e; position: sticky; top: 0; z-index: 1000; }
    .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 20px; }
    .team-card { background-color: #1b2a3c; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); overflow: hidden; }
    .team-header { padding: 14px 20px; background: linear-gradient(135deg, #132a4e 0%, #0d3b66 100%); display: flex; justify-content: space-between; align-items: center; }
    .team-header h2 { font-size: 1.2em; font-weight: 600; margin: 0; }
    .team-header .total-score { font-size: 1em; background-color: #274060; padding: 6px 12px; border-radius: 8px; }
    .member-list { list-style: none; margin: 0; padding: 0; }
    .member { padding: 12px 20px; border-top: 1px solid #274060; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: background-color 0.3s ease; }
    .member:nth-child(odd) { background-color: #16243b; }
    .member:hover { background-color: #213559; }
    .member .name { font-size: 1em; display: flex; align-items: center; }
    .member .score { font-weight: bold; }
    .icon { margin-right: 8px; font-size: 1.1em; }
    details summary::-webkit-details-marker { display: none; }
    details { background-color: #0e1a28; }
    summary { list-style: none; outline: none; }
    .details-content { padding: 12px 24px; background-color: #0e1a28; border-top: 1px solid #274060; display: none; }
    details[open] .details-content { display: block; }
    .details-content ul { list-style: none; margin: 0; padding: 0; }
    .details-content li { margin: 4px 0; font-size: 0.9em; }
    .details-content p { margin: 0; font-size: 0.9em; }
    .gold .name, .gold .score { color: #FFD700; }
    .silver .name, .silver .score { color: #C0C0C0; }
    .bronze .name, .bronze .score { color: #CD7F32; }
    .eliminated .name, .eliminated .score { color: #FF4C4C; }
    .leaderboards { display: flex; flex-wrap: wrap; gap: 2rem; margin-top: 20px; }
    .leaderboards > div { flex: 1 1 50%; }
    .top-card { background-color: #1b2a3c; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.4); padding: 16px 20px; margin-bottom: 25px; }
    .top-card h3 { margin-top: 0; margin-bottom: 10px; font-size: 1.4em; font-weight: 600; }
    .top-list { list-style: none; margin: 0; padding: 0; }
    .top-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #274060; }
    .top-item:last-child { border-bottom: none; }
    .rank { font-weight: bold; margin-right: 8px; }
  </style>
</head>
<body>
  <h1>Freight Gauntlet: Haul or Nothing</h1>
  <div class="container">
    <div class="leaderboards">
      <div id="top-leaderboard"></div>
      <div id="team-board"></div>
    </div>
    <div id="leaderboard"></div>
  </div>
  <script>
    const accentColors=['#5A67D8','#ED8936','#48BB78','#D53F8C','#4299E1','#ECC94B','#F6AD55','#4FD1C5','#9F7AEA','#38B2AC','#F56565'];
    const ELIMINATED=new Set(["Clarens Legagneur","Nicholas Peffenberger","Jacob Archer","Justin Bagent","Courtney Monroy"]);
    const teams=__TEAMS_JSON__;
    function renderLeaderboard(){
      const all=[]; teams.forEach(t=>{t.total=t.members.reduce((s,m)=>s+(m.score||0),0); t.members.forEach(m=>all.push({name:m.name,score:m.score,team:t.name}));});
      const nonElim=all.filter(m=>!ELIMINATED.has(m.name)); const min=nonElim.length?Math.min(...nonElim.map(m=>m.score)):0; const flagged=new Set(nonElim.filter(m=>m.score===min).map(m=>m.name));
      const top=[...all].sort((a,b)=>b.score-a.score).slice(0,5); const top3=top.slice(0,3).map(m=>m.name);
      const tb=document.getElementById('team-board'); tb.innerHTML=''; const tcard=document.createElement('div'); tcard.className='top-card'; tcard.innerHTML='<h3>Team Leaderboard</h3>'; const tlist=document.createElement('ul'); tlist.className='top-list';
      [...teams].sort((a,b)=>b.total-a.total).forEach((t,i)=>{const li=document.createElement('li'); li.className='top-item'; li.innerHTML=\`<span class="rank">#\${i+1}</span><span>\${t.name}</span><span>\${t.total} pts</span>\`; tlist.appendChild(li);}); tcard.appendChild(tlist); tb.appendChild(tcard);
      const topC=document.getElementById('top-leaderboard'); topC.innerHTML=''; const tc=document.createElement('div'); tc.className='top-card'; tc.innerHTML='<h3>Top 5 Scorers Overall</h3>'; const tl=document.createElement('ul'); tl.className='top-list';
      top.forEach((p,i)=>{const li=document.createElement('li'); li.className='top-item'; li.innerHTML=\`<span class="rank">#\${i+1}</span><span>\${p.name}</span><span>\${p.score} pts</span>\`; tl.appendChild(li);}); tc.appendChild(tl); topC.appendChild(tc);
      const lb=document.getElementById('leaderboard'); lb.innerHTML=''; teams.forEach((team,idx)=>{const card=document.createElement('div'); card.className='team-card'; const header=document.createElement('div'); header.className='team-header'; header.style.background=\`linear-gradient(135deg, \${accentColors[idx%accentColors.length]} 0%, #0d3b66 100%)\`; card.style.borderLeft=\`8px solid \${accentColors[idx%accentColors.length]}\`; header.innerHTML=\`<h2>\${team.name}</h2><div class="total-score">Total: \${team.total} pts</div>\`; card.appendChild(header);
        let mvpName='',mvpScore=-1; team.members.forEach(m=>{if((m.score||0)>mvpScore){mvpScore=m.score||0;mvpName=m.name;}});
        const ul=document.createElement('ul'); ul.className='member-list'; team.members.forEach(member=>{const details=document.createElement('details'); const summary=document.createElement('summary'); summary.className='member';
          let icon=''; if(ELIMINATED.has(member.name)) icon='â˜ ï¸'; else if(top3.includes(member.name)){const i=top3.indexOf(member.name); icon=i===0?'ðŸ¥‡':i===1?'ðŸ¥ˆ':'ðŸ¥‰';} else if(flagged.has(member.name)) icon='ðŸš©'; else if(member.name===mvpName && (member.score||0)>0) icon='ðŸ‘‘';
          if(ELIMINATED.has(member.name)||flagged.has(member.name)) summary.classList.add('eliminated'); else if(top3.includes(member.name)){const i=top3.indexOf(member.name); summary.classList.add(i===0?'gold':i===1?'silver':'bronze');}
          const nameDiv=document.createElement('div'); nameDiv.className='name'; if(icon){const s=document.createElement('span'); s.className='icon'; s.textContent=icon; nameDiv.appendChild(s);} const nameText=document.createElement('span'); nameText.textContent=member.name; nameDiv.appendChild(nameText);
          const scoreDiv=document.createElement('div'); scoreDiv.className='score'; scoreDiv.textContent=\`\${member.score} pts\`;
          summary.appendChild(nameDiv); summary.appendChild(scoreDiv);
          const dc=document.createElement('div'); dc.className='details-content';
          if(member.details&&member.details.length){const u=document.createElement('ul'); member.details.forEach(d=>{const li=document.createElement('li'); li.textContent=\`\${d.label}: \${d.points} pts\`; u.appendChild(li);}); const t=document.createElement('li'); t.innerHTML=\`<strong>Total</strong>: \${member.score} pts\`; u.appendChild(t); dc.appendChild(u);} else {const p=document.createElement('p'); p.textContent='No points awarded yet.'; dc.appendChild(p);}
          details.appendChild(summary); details.appendChild(dc); const li=document.createElement('li'); li.appendChild(details); ul.appendChild(li);});
        card.appendChild(ul); lb.appendChild(card);});
    }
    renderLeaderboard();
  </script>
</body>
</html>
--></template>
</body>
</html>
